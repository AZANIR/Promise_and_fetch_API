/**
 * Приклади використання setTimeout
 * 
 * setTimeout дозволяє виконати функцію один раз через певний проміжок часу.
 * Синтаксис: setTimeout(callback, delay, ...args)
 */

// ============================================
// Приклад 1: Базове використання setTimeout
// ============================================

console.log('Початок');

// Виконання через 1 секунду
setTimeout(() => {
    console.log('Це виконається через 1 секунду');
}, 1000);

console.log('Кінець (виконається одразу)');

// Результат:
// Початок
// Кінець (виконається одразу)
// Це виконається через 1 секунду

// ============================================
// Приклад 2: Передача параметрів у callback
// ============================================

function greet(name, message) {
    console.log(`${message}, ${name}!`);
}

// setTimeout може приймати додаткові аргументи
setTimeout(greet, 2000, 'Олена', 'Привіт');
// Через 2 секунди виведе: Привіт, Олена!

// ============================================
// Приклад 3: Збереження ID таймера
// ============================================

// setTimeout повертає ID таймера, який можна використати для очищення
const timerId = setTimeout(() => {
    console.log('Це не виконається');
}, 5000);

console.log('ID таймера:', timerId);

// Можна очистити таймер до його виконання
// clearTimeout(timerId);

// ============================================
// Приклад 4: Послідовні таймери
// ============================================

console.log('Крок 1: Початок');

setTimeout(() => {
    console.log('Крок 2: Через 500мс');
    
    setTimeout(() => {
        console.log('Крок 3: Ще через 500мс');
        
        setTimeout(() => {
            console.log('Крок 4: Ще через 500мс');
        }, 500);
    }, 500);
}, 500);

// ============================================
// Приклад 5: Симуляція затримки у функції
// ============================================

/**
 * Функція з затримкою виконання
 */
function delayedFunction(data, delay, callback) {
    setTimeout(() => {
        callback(data);
    }, delay);
}

delayedFunction('Дані оброблені', 1000, (result) => {
    console.log(result);
});

// ============================================
// Приклад 6: Таймаут для обмеження часу виконання
// ============================================

/**
 * Виконання операції з таймаутом
 */
function executeWithTimeout(operation, timeout, onTimeout) {
    const timerId = setTimeout(() => {
        onTimeout(new Error('Операція перевищила час очікування'));
    }, timeout);
    
    // Симуляція операції
    operation(() => {
        clearTimeout(timerId);
        console.log('Операція завершена успішно');
    });
}

// Використання
executeWithTimeout(
    (callback) => {
        // Симуляція швидкої операції
        setTimeout(callback, 500);
    },
    2000,
    (error) => {
        console.error('Таймаут:', error.message);
    }
);

// ============================================
// Приклад 7: Дебаунс (відкладене виконання)
// ============================================

/**
 * Дебаунс - виконання функції тільки після того, як пройшов
 * певний час без нових викликів
 */
function debounce(func, delay) {
    let timeoutId;
    
    return function(...args) {
        // Очищаємо попередній таймер
        clearTimeout(timeoutId);
        
        // Встановлюємо новий таймер
        timeoutId = setTimeout(() => {
            func.apply(this, args);
        }, delay);
    };
}

// Приклад: пошук при введенні тексту
const searchFunction = debounce((query) => {
    console.log('Пошук:', query);
}, 500);

// Симуляція швидкого введення
searchFunction('a');
searchFunction('ab');
searchFunction('abc'); // Тільки цей виклик виконається через 500мс

// ============================================
// Приклад 8: Використання в тестах (очікування)
// ============================================

/**
 * Утиліта для очікування в тестах
 */
function waitForCondition(condition, timeout = 5000, interval = 100) {
    return new Promise((resolve, reject) => {
        const startTime = Date.now();
        
        function check() {
            if (condition()) {
                resolve();
            } else if (Date.now() - startTime >= timeout) {
                reject(new Error('Умова не виконалася за вказаний час'));
            } else {
                setTimeout(check, interval);
            }
        }
        
        check();
    });
}

// Використання в тестах
let elementVisible = false;

setTimeout(() => {
    elementVisible = true;
}, 1000);

waitForCondition(() => elementVisible, 2000)
    .then(() => console.log('Елемент з\'явився!'))
    .catch((error) => console.error('Помилка:', error.message));

// ============================================
// Висновок
// ============================================

/**
 * setTimeout корисний для:
 * - Відкладених операцій
 * - Симуляції затримок
 * - Таймаутів
 * - Дебаунсу
 * - Очікування в тестах
 * 
 * Важливо пам'ятати:
 * - setTimeout не гарантує точний час виконання
 * - Мінімальна затримка залежить від браузера/середовища
 * - Завжди очищайте таймери, якщо вони більше не потрібні
 */

